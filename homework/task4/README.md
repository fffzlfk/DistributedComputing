## 三类分布式存储系统

### 块存储系统

块存储将数据视为一系列固定大小的“块”，其中每个文件或对象可以分布在多个块上。

### 对象存储系统

对象存储是一种数据存储，其中每个数据单元（称为“对象”）作为离散单元存储。这些对象实际上可以是任何类型的数据：pdf，视频，音频，文本，网站数据或任何其他文件类型。

### 文件存储系统

文件存储也称为文件级存储或基于文件的存储，数据会以单条信息的形式存储在文件夹中，树形组织结构。

### 三类存储方式的差异

- 块存储
    - 块是定长的，每个块有一个独立标识

- 文件存储
    - 有文件和目录层次
    - 文件有文件名和丰富的元数据

- 对象存储
    - 对象是变长的
    - 有独立标识和简单的元数据
    - 无层次结构
    - 接口一般是RESTful API

## 阅读《The Hadoop Distributed File System》

- 客户端读取HDFS系统中指定文件指定偏移量处的数据时，工作流程是什么？
    - Client从NameNode获取到文件的数据块信息（块大小）对应DataNode编号的的块列表（并且按距离Client的距离进行排序）
    - 根据块大小算出指定偏移量处对应的块编号
    - Client从最近的DataNode下载数据块，完成读取

- 客户端向HDFS系统中指定文件追加写入数据的工作流程是什么？
    - Client请求申请文件租约（相当于写锁）
    - 获取到租约之后，在后续的写入过程中以固定周期对租约续期（防止其他客户端请求写入）
    - Client从NameNode获取到对应文件的末尾数据块。如果追加数据超过了块大小，则NameNode将数据切分为数据块之后对每个数据块分配DataNode，完成数据写入

- 新增加一个数据块时，HDFS如何选择存储该数据块的物理节点？

    机架感知的策略：以3副本存储为例，HDFS的存放策略是将一个副本放在本地的机架节点上，一个副本放在同一个机架的另一个节点上，最后一个副本放在不同机架的节点上。这样一方面可以减少写入时不同机架间的数据传输时间，另一方面提高了数据可靠性。

-  HDFS采用了哪些措施应对数据块损坏或丢失问题？
    - 多副本放置策略
    - 校验和：HDFS对写入的所有数据计算校验和，并在读取数据时验证校验和。
    - 块扫描（block scanner）：对DataNode上所有block进行数据完整性校验，读取DataNode的所有block，以及对应的元数据文件，进行数据完整性的校验。

- HDFS采用了什么措施应对主节点失效问题？
    - NameNode可以配置成活动（active）——备用（standy）两个节点，当活动NameNode节点失效后，备用NameNode就会接管它的任务，继续处理Client请求。
    - 故障转移控制器(failover controller) 可以在几十秒钟内完成备用NameNode的切换。
    - 每个 NameNode 都运行着一个故障转移控制器，其工作就是通过一个心跳机制，监视 活动 NameNode 是否失效，并且在 NameNode 失效时自动进行故障切换。除了自动故障转移外，管理员也可以手动发起故障转移，将两个 NameNode 节点互换角色。

-  NameNode维护的“数据块—物理节点对应表”需不需要在硬盘中备份？为什么？

    不需要。即使NameNode失效之后，当备用NameNode切换完成之后，DataNode向新的NameNode发送数据块报告，这样NameNode维护的“数据块——物理节点对应表”就重新建立好了。所以说并不需要在硬盘中备份。
